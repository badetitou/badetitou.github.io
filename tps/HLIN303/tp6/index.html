<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Benoît Verhaeghe's blog">
    

    <link rel="icon" href="/img/logo/logo.png" type="image/x-icon">


    <title>Filtres et Entrées/Sorties formattées - Benoît Verhaeghe</title>

    <link rel="canonical" href="http://badetitou.github.io/tps/HLIN303/tp6/">

    <!-- <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css"> -->
    
    <script src="https://kit.fontawesome.com/5574707d0b.js" crossorigin="anonymous"></script>
    
    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <!-- My JS -->
    <script src="/js/my-head.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link type="application/atom+xml" rel="alternate" href="http://badetitou.github.io/feed.xml" title="Benoît Verhaeghe" />

</head>


<body>

    <nav>
    <div class="nav-wrapper">
        <a href="#" onclick="openNav()" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        
        <ul class="left hide-on-med-and-down"> <li>
        <a href="/" style="margin-left: 20px;"> Benoît Verhaeghe</a></li></ul>

        <ul class="right hide-on-med-and-down">
            <li>
                <span style="width: 30px; display: inline-block;">
                    <i id="theme-switch" style="font-size: 20px" class="fa-solid fa-1x"></i>
                </span>
            </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
            <li><a href="/teaching/">Teaching</a></li>
        
        
        
        
        
        
        
        
        
            <li><a href="/post/">Posts</a></li>
        
        
        
        
        
        
        
        
        
            <li><a href="/projects/">Projects</a></li>
        
        
        
            <li><a href="/research/">Research</a></li>
        
        
        
        
        
        </ul>
        
    </div>
</nav>

<ul class="sidenav" id="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <li><a href="/">Home</a></li>
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
            <li><a href="/teaching/">Teaching</a></li>
        
    
        
        
    
        
        
    
        
            <li><a href="/post/">Posts</a></li>
        
    
        
        
    
        
        
    
        
            <li><a href="/projects/">Projects</a></li>
        
    
        
            <li><a href="/research/">Research</a></li>
        
    
        
        
    
</ul>

<div id="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Post Header -->
<header class="intro-header"
    style="background-image: url('/img/bg/keyboard.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12">
                <div class="post-heading  text-center">
                    <h1>Filtres et Entrées/Sorties formattées</h1>
                    
                    <h2 class="subheading">TP6 - Correction</h2>
                    
                    <span class="meta">Posted by
                        Benoît "badetitou" Verhaeghe on
                        October 21, 2019</span>
                    <span class="post-meta">
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<article class="container">
    <div class="row">
        <div class="col s12 m12">
            <div class="card">
                <div class="card-content article-content">
                    <h2 id="tp4---filtres-et-entréessorties-formattées">TP4 - Filtres et Entrées/Sorties formattées</h2>

<h3 id="exercice-26-tdtp">Exercice 26 (TD/TP)</h3>

<p>On souhaite écrire un filtre montail qui ne rejette que les n dernières lignes d’un fichier.</p>

<ol>
  <li>Quelle structure de données nécessite ce programme ? Décrivez précisément cette structure de données !</li>
  <li>Ecrire un algorithme</li>
  <li>Ecrire le programme C correspondant.</li>
  <li>l’option -c43 de tail permet de lire les 43 derniers caractères. Implémenter cette option.</li>
</ol>

<h4 id="solution-26">Solution 26</h4>

<ul>
  <li>
    <p>Il faut programmer une file d’attente (FIFO) avec éjection automatique de taille n afin de
conserver les lignes lues. On crèe une structure comprenant un tableau de n+1 chaînes, sa taille, son
indice de tête et de queue. On ajoute en queue, on retire en tête. Le tableau est circulaire, tete et queue
sont toujours incrémenté modulo la taille du tableau. La fifo est vide lorsque tete==queue, elle est pleine
lorsque queue”+1”=tete.</p>
  </li>
  <li>
    <p>2</p>
  </li>
</ul>

<pre><code class="language-no">fic=ouvrir(argv[2])
Fifo fifo[atoi(argv[1][1...])
Tq !FinDeFichier
ajouter(fifo,lireLigne(fic))
fermer(fic)
afficher fifo
</code></pre>

<ul>
  <li>programme montail.c</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1">/* printf */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="c1">/* strlen, strcpy */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="c1">/* open */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="c1">/* read */</span><span class="cp">
</span>

<span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
    <span class="kt">char</span> <span class="o">**</span> <span class="n">tch</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">taille</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tete</span><span class="p">;</span> <span class="cm">/* ptr de tete */</span>
    <span class="kt">int</span> <span class="n">queue</span><span class="p">;</span> <span class="cm">/* ptr de queue */</span>
<span class="p">}</span> <span class="n">fifo_ch</span><span class="p">;</span> <span class="cm">/* fifo de chaînes */</span>

<span class="n">fifo_ch</span><span class="o">*</span> <span class="nf">fifo_ch_creer</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">taille</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="cm">/* au moins une case */</span>
        <span class="k">return</span> <span class="n">tailleNULL</span><span class="p">;</span>
    <span class="n">fifo_ch</span><span class="o">*</span> <span class="n">r</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fifo_ch</span><span class="p">));</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">taille</span><span class="o">=</span><span class="n">taille</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* tjrs une case vide entre queue et tete */</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">tch</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">taille</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span>
    <span class="n">r</span><span class="o">-&gt;</span><span class="n">tete</span><span class="o">=</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">queue</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="cm">/* fifo vide */</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">fifo_ch</span> <span class="o">*</span> <span class="nf">fifo_ch_ajouter</span><span class="p">(</span><span class="n">fifo_ch</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">){</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">new</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">new</span><span class="p">,</span><span class="n">s</span><span class="p">);</span> <span class="cm">/* copie dynamique de s */</span>
    <span class="k">if</span><span class="p">((</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">)</span><span class="o">%</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">taille</span><span class="o">==</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">tete</span><span class="p">){</span> <span class="cm">/* fifo pleine */</span>
        <span class="n">free</span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">tch</span><span class="p">[</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">tete</span><span class="p">]);</span>
        <span class="cm">/* désallouer la chaîne en tête */</span>
        <span class="n">f</span><span class="o">-&gt;</span><span class="n">tete</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">tete</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">taille</span><span class="p">;</span>
        <span class="cm">/* avancer la tete */</span>
    <span class="p">}</span>
    <span class="n">f</span><span class="o">-&gt;</span><span class="n">tch</span><span class="p">[</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">]</span><span class="o">=</span><span class="n">new</span><span class="p">;</span>
    <span class="n">f</span><span class="o">-&gt;</span><span class="n">queue</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">queue</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">taille</span><span class="p">;</span>
    <span class="cm">/* avancer la queue sur case vide */</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">fifo_ch_afficher</span><span class="p">(</span><span class="n">fifo_ch</span> <span class="o">*</span><span class="n">f</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">tete</span><span class="p">;</span><span class="n">i</span><span class="o">!=</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">;</span><span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">taille</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">tch</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="o">*</span><span class="n">env</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">!=</span><span class="mi">3</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Syntaxe incorrecte : %s -8 fichier</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="nb">NULL</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Impossible d’ouvrir le fichier : %s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">nb</span><span class="o">=</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* +1 pour éviter le - */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">nb</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Impossible d’afficher %d lignes !</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">nb</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">fifo_ch</span><span class="o">*</span> <span class="n">fifo</span><span class="o">=</span><span class="n">fifo_ch_creer</span><span class="p">(</span><span class="n">nb</span><span class="p">);</span>
    <span class="cp">#define TAILLE 2048
</span>    <span class="kt">char</span> <span class="n">ligne</span><span class="p">[</span><span class="n">TAILLE</span><span class="p">];</span> <span class="cm">/* espérons que cela suffise ! */</span>
    <span class="k">while</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">ligne</span><span class="p">,</span><span class="n">TAILLE</span><span class="p">,</span><span class="n">f</span><span class="p">)</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">){</span>
        <span class="n">fifo_ch_ajouter</span><span class="p">(</span><span class="n">fifo</span><span class="p">,</span><span class="n">ligne</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fifo_ch_afficher</span><span class="p">(</span><span class="n">fifo</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="exercice-27-td">Exercice 27 (TD)</h3>

<p>Etudiez le programme suivant : programme testaffichint.c</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1">/* printf */</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="o">*</span><span class="n">env</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">12345</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%4.0d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>L’affichage obtenu est le suivant :</p>

<pre><code class="language-no">$testaffichint
12345
90 $
</code></pre>

<ol>
  <li>Quelle différence esiste-t-il entre ces deux affichages ?</li>
  <li>Précisez la valeur de 90__. Quel est le “boutisme” (endianness) de cette machine ?</li>
  <li>Quels avantages et inconvénients de ces types de codage dans les fichiers en matière de sauvegarde de
données ?</li>
</ol>

<h4 id="solution-27">Solution 27</h4>

<ol>
  <li>Le premier affichage est formatté pour la lecture par l’être humain, le second est une recopie
binaire de l’entier tel qu’il est stocké en machine.</li>
  <li>48 ∗ 256 + 57 = 12345 or 48 est le code ASCII du 0 et 57 celui du 9. Les deux octets de poids forts à 0
ne sont pas affichés (espace). Cette machine est little-endian ou petit-boutiste ou mot de poids faible en
tête.</li>
  <li>Les avantages du binaire sont la concision (taille) et la vitesse de sauvegarde/chargement. L’avantage du
formattage est la lisibilité !</li>
</ol>

<h3 id="exercice-28-tdtp-fichiers-csv">Exercice 28 (TD/TP fichiers .csv)</h3>

<p>En examinant certains fichiers de configuration situés dans le répertoire /etc, tels que passwd, fstab, group,
on voit que ces fichiers textes sont composés d’articles d’une ligne, chaque article étant composé de champs
séparés par un caractère (:). On souhaite écrire une commande monselect correspondant de manière simplifiée
à l’instruction SELECT de SQL. Les champs étant numérotés de 1 à n, l’exemple suivant affichera chaque ligne
du fichier passwd dont le deuxième champ est égal à “dupont” :
monselect /etc/passwd : 2 dupont</p>

<ol>
  <li>Ecrire un algorithme</li>
  <li>Ecrire le programme C correspondant.</li>
</ol>

<h4 id="solution-28">Solution 28</h4>

<ol>
  <li>Ecrire un algorithme</li>
</ol>

<pre><code class="language-no">fic=ouvrir(argv[1])
Tq l=lireLigne(fic)!=FinDeFichier
    tch=strsplit(l,argv[2])
    Si tch[atoi(argv[3])]==argv[4]
        afficher l
fermer(fic)
</code></pre>

<ol>
  <li>programme monselect.c</li>
</ol>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="c1">/* strlen, strcpy */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span>

<span class="kt">char</span> <span class="o">**</span><span class="nf">strsplit</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">sep</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nbsep</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="cm">/* nb de séparateurs */</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="sc">'\0'</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">nbsep</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//printf("nbsep = %d\n",nbsep);</span>
    <span class="kt">char</span> <span class="o">**</span><span class="n">res</span><span class="o">=</span><span class="n">malloc</span><span class="p">((</span><span class="n">nbsep</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">));</span> <span class="cm">/* allocation du résultat */</span>
    <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">APRESSEP</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="cm">/* faux */</span>
    <span class="k">do</span><span class="p">{</span>
        <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="c1">// lng de la sous-chaîne</span>
        <span class="k">while</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="sc">'\0'</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="n">sep</span><span class="p">){</span>
            <span class="n">l</span><span class="o">++</span><span class="p">;</span>
            <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">strncpy</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">s</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">);</span>
        <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
        <span class="n">n</span><span class="o">++</span><span class="p">;</span>
        <span class="n">APRESSEP</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">sep</span><span class="p">){</span>
            <span class="n">i</span><span class="o">++</span><span class="p">;</span>
            <span class="n">APRESSEP</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="sc">'\0'</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">APRESSEP</span><span class="p">){</span> <span class="cm">/* sep suivi de fin de chaîne */</span>
        <span class="c1">//printf("n=%d ; i=%d\n",n,i);</span>
        <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span>
        <span class="n">n</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="o">*</span><span class="n">env</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">!=</span><span class="mi">5</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Syntaxe incorrecte : %s fichier : 2 </span><span class="se">\"</span><span class="s">a chercher</span><span class="se">\"\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">==</span><span class="nb">NULL</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Impossible d'ouvrir le fichier : %s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">nb</span><span class="o">=</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* de 0 à n */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">nb</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Impossible d'afficher le champ %d !</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="n">sep</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// printf("|%s|",argv[4]);</span>
    <span class="cp">#define TAILLE 2048
</span>    <span class="kt">char</span> <span class="n">ligne</span><span class="p">[</span><span class="n">TAILLE</span><span class="p">];</span> <span class="cm">/* espérons que cela suffise ! */</span>
    <span class="k">while</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">ligne</span><span class="p">,</span><span class="n">TAILLE</span><span class="p">,</span><span class="n">f</span><span class="p">)</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">l</span><span class="o">=</span><span class="n">strlen</span><span class="p">(</span><span class="n">ligne</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ligne</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="sc">'\n'</span><span class="p">)</span>
            <span class="n">ligne</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="sc">'\0'</span><span class="p">;</span> <span class="cm">/* suppression du retour du dernier champ */</span>
        <span class="kt">char</span><span class="o">**</span><span class="n">tch</span><span class="o">=</span><span class="n">strsplit</span><span class="p">(</span><span class="n">ligne</span><span class="p">,</span><span class="n">sep</span><span class="p">);</span>
        <span class="c1">// printf("champ : |%s| de taille %d\n" ,tch[nb],strlen(tch[nb]));</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">tch</span><span class="p">[</span><span class="n">nb</span><span class="p">],</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">ligne</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="exercice-29-tp-sauvegarde-binaire">Exercice 29 (TP sauvegarde binaire)</h3>

<p>Soit un tableau d’étudiants que l’on veut sauver (écrire) dans un fichier au format binaire. Suivent les définitions
de type et de ce tableau :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">code</span><span class="p">;</span>
    <span class="cm">/* code étudiant 20091234 */</span>
    <span class="kt">char</span> <span class="n">nom</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span> <span class="cm">/* "dupont" */</span>
    <span class="kt">char</span> <span class="n">dnais</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* 19901231 */</span>
<span class="p">}</span> <span class="n">etudiant</span><span class="p">;</span>
<span class="n">etudiant</span> <span class="n">tabetu</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">=</span><span class="p">{</span> <span class="p">{</span><span class="mi">20091234</span><span class="p">,</span><span class="s">"dupont"</span><span class="p">,</span><span class="s">"19891231"</span><span class="p">},</span>
    <span class="p">{</span><span class="mi">20091235</span><span class="p">,</span><span class="s">"martin"</span><span class="p">,</span><span class="s">"19891130"</span><span class="p">},</span>
    <span class="mi">20</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">}</span>
<span class="p">};</span> <span class="cm">/* tableau des étudiants */</span>
</code></pre></div></div>

<p>Le tableau est compacté vers les indices faibles et le premier article (struct)ayant un code nul indique la fin des
étudiants.</p>

<ol>
  <li>Ecrire un programme C permettant de sauver le tableau dans un fichier binaire passé en argument et ne contenant que les étudiants présents.</li>
  <li>Visualiser le fichier sauvé en hexadécimal (hexl ou od -cx) et donner une interprétation.</li>
  <li>Ecrire un programme C permettant de lire le fichier sauvé afin de le stocker dans un tableau puis afficher
le résultat.</li>
</ol>

<h4 id="solution-29">Solution 29</h4>

<ul>
  <li>programme sauveretudiants.c</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1">/* printf */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="c1">/* strlen, strcpy */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">code</span><span class="p">;</span> <span class="cm">/* code étudiant 20091234 */</span>
    <span class="kt">char</span> <span class="n">nom</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span> <span class="cm">/* "dupont" */</span>
    <span class="kt">char</span> <span class="n">dnais</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* 19901231 */</span>
<span class="p">}</span> <span class="n">etudiant</span><span class="p">;</span>

<span class="n">etudiant</span> <span class="n">tabetu</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">=</span><span class="p">{</span> <span class="p">{</span><span class="mi">20091234</span><span class="p">,</span><span class="s">"dupont"</span><span class="p">,</span><span class="s">"19891231"</span><span class="p">},</span>
<span class="p">{</span><span class="mi">20091235</span><span class="p">,</span><span class="s">"martin"</span><span class="p">,</span><span class="s">"19891130"</span><span class="p">},</span>
<span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">""</span><span class="p">}</span>
<span class="p">};</span> <span class="cm">/* tableau des étudiants */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="o">*</span><span class="n">env</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">!=</span><span class="mi">2</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Syntaxe incorrecte : %s fichier</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d|%-20.20s|%-8.8s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="p">,</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nom</span><span class="p">,</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dnais</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"w"</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">tabetu</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">etudiant</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Tableau binaire</li>
</ul>

<pre><code class="language-no">00000000:6291 3201 6475 706f 6e74 0000 0000 b.2.dupont......
00000010:0000 0000 0000 0000 3139 3839 3132 ........19891231
00000020:6391 3201 6d61 7274 696e 0000 0000 c.2.martin......
00000030:0000 0000 0000 0000 3139 3839 3131 ........19891130
</code></pre>

<p>l’entier sur 4 octets en C2, puis le nom sur 20 octets,</p>

<ul>
  <li>programme chargeretudiants.c</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1">/* printf */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="c1">/* strlen, strcpy */</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">code</span><span class="p">;</span> <span class="cm">/* code étudiant 20091234 */</span>
    <span class="kt">char</span> <span class="n">nom</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span> <span class="cm">/* "dupont" */</span>
    <span class="kt">char</span> <span class="n">dnais</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* 19901231 */</span>
<span class="p">}</span> <span class="n">etudiant</span><span class="p">;</span>

<span class="n">etudiant</span> <span class="n">tabetu</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span> <span class="cm">/* tableau des étudiants */</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="o">*</span><span class="n">env</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">!=</span><span class="mi">2</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Syntaxe incorrecte : %s fichier</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="c1">//while(EOF!=fread(tabetu+i,sizeof(etudiant),1,f);</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">fread</span><span class="p">(</span><span class="n">tabetu</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">etudiant</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="cm">/* fin */</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d|%-20.20s|%-8.8s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">code</span><span class="p">,</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nom</span><span class="p">,</span><span class="n">tabetu</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dnais</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Après avoir modifié à la main le fichier sauvé, on obtient :</p>

<pre><code class="language-no">20091234|meynard        |19891231
20091235|tototututututut|19891130
</code></pre>

                </div>
            </div>
        </div>
    </div>
</article>

    <!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col m12">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="https://twitter.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a rel="me" href="https://piaille.fr/@badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://orcid.org/0000-0002-4588-2698">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-orcid fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.linkedin.com/in/benoitverhaeghe">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:benoit@badetitou.fr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="text-center">Copyright &copy; badetitou 2023
                </p>
            </div>
        </div>
    </div>
</footer>

    <!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<script src="/js/my.js"></script>
<script src="/js/my-sidenav.js"></script>

<script src="/js/lightense.min.js"></script>

<script>

  // Init Lightense
  window.addEventListener("load", function() {
    Lightense("img:not(.no-lightense),.lightense", {
      background: 'rgba(0,0,0,0.05)'
    });
  }, false);

  // Example: Lazy Lightense
  document.addEventListener("DOMContentLoaded", function(e) {
    function createDom(type, cssClass) {
      var div = document.createElement(type);
      div.className = cssClass;
      return div;
    }

    var thumb = document.querySelector(".lightense-lazy");
    var original = new Image();

    // Init wrapper
    var wrap = createDom("div", "lightense-lazy-wrap");
    thumb.parentNode.insertBefore(wrap, thumb);
    wrap.appendChild(thumb);

    // Wrap thumbnail
    var thumbWrap = createDom("div", "lightense-lazy-thumb");
    thumbWrap.appendChild(thumb);
    wrap.appendChild(thumbWrap);

    // Wrap original
    var originalWrap = createDom("div", "lightense-lazy-large");
    original.src = thumb.dataset.original;
    originalWrap.appendChild(original);
    wrap.appendChild(originalWrap);

    // Load original image
    original.addEventListener(
      "load",
      function() {
        wrap.classList.add("on");
      },
      false
    );
  });
</script>


</body>

</html>
