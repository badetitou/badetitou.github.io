<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Benoît Verhaeghe's blog">
    

    <link rel="icon" href="/img/logo/logo.png" type="image/x-icon">


    <title>Reporting sur la commande last - Benoît Verhaeghe</title>

    <link rel="canonical" href="http://badetitou.github.io/tps/HLIN303/tp7_py4/">

    <!-- <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css"> -->
    
    <script src="https://kit.fontawesome.com/5574707d0b.js" crossorigin="anonymous"></script>
    
    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/main.css">
    <!-- My JS -->
    <script src="/js/my-head.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link type="application/atom+xml" rel="alternate" href="http://badetitou.github.io/feed.xml" title="Benoît Verhaeghe" />

</head>


<body>

    <nav>
    <div class="nav-wrapper">
        <a href="#" onclick="openNav()" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        
        <ul class="left hide-on-med-and-down"> <li>
        <a href="/" style="margin-left: 20px;"> Benoît Verhaeghe</a></li></ul>

        <ul class="right hide-on-med-and-down">
            <li>
                <span style="width: 30px; display: inline-block;">
                    <i id="theme-switch" style="font-size: 20px" class="fa-solid fa-1x"></i>
                </span>
            </li>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
            <li><a href="/teaching/">Teaching</a></li>
        
        
        
        
        
        
        
        
        
            <li><a href="/post/">Posts</a></li>
        
        
        
        
        
        
        
        
        
            <li><a href="/projects/">Projects</a></li>
        
        
        
            <li><a href="/research/">Research</a></li>
        
        
        
        
        
        </ul>
        
    </div>
</nav>

<ul class="sidenav" id="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <li><a href="/">Home</a></li>
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
            <li><a href="/teaching/">Teaching</a></li>
        
    
        
        
    
        
        
    
        
            <li><a href="/post/">Posts</a></li>
        
    
        
        
    
        
        
    
        
            <li><a href="/projects/">Projects</a></li>
        
    
        
            <li><a href="/research/">Research</a></li>
        
    
        
        
    
</ul>

<div id="sidenav-overlay" onclick="closeNav()"></div>

    <!-- Post Header -->
<header class="intro-header"
    style="background-image: url('/img/bg/keyboard.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12">
                <div class="post-heading  text-center">
                    <h1>Reporting sur la commande last</h1>
                    
                    <h2 class="subheading">Python - TP4</h2>
                    
                    <span class="meta">Posted by
                        Benoît "badetitou" Verhaeghe on
                        December 2, 2019</span>
                    <span class="post-meta">
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<article class="container">
    <div class="row">
        <div class="col s12 m12">
            <div class="card">
                <div class="card-content article-content">
                    <h2 id="reporting-sur-la-commande-last">Reporting sur la commande last</h2>

<h3 id="sujet">Sujet</h3>

<p>En utilisant la commande last (ou en utilisant un fichier simulant le résultat de cette commande sur un poste de travail très fréquenté), écrire un script python qui liste les jours de connexion des utilisateurs qui ont fréquenté cette machine (en sachant que vous désirez surveiller les (mauvaises) fréquentations de celle-ci).</p>

<p>Réalisez ce programme en quatre étapes (qui se complèteront progressivement) :</p>

<ul>
  <li>Pour information, exécutez dans le script la commande last et affichez son résultat dans le terminal</li>
  <li>Récupérez maintenant le résultat de cette commande dans votre script. Mettez en place progressivement l’expression
régulière qui extrait :
    <ul>
      <li>le login</li>
      <li>le nom du mois et le numéro du jour dans le mois (la date)</li>
      <li>le nombre d’heures</li>
      <li>le nombre de minutes</li>
    </ul>
  </li>
  <li>et affichez ces informations</li>
  <li>Affichez :
    <ul>
      <li>le nombre de connexions par login (via un dictionnaire)</li>
      <li>le nombre de connexions et le temps de connexions (en minutes) par login (via un dictionnaire de listes)</li>
      <li>puis par login et par date (via un dictionnaires de dictionnaires de listes)</li>
      <li>Suivant des paramètres indiquant un nombre maximal de connexions et/ou un temps de connexion cumulé maximal, affichez des alertes !</li>
    </ul>
  </li>
</ul>

<h4 id="correction">Correction</h4>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">collections</span><span class="p">,</span> <span class="n">re</span>


<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">'r'</span><span class="p">)</span>
<span class="n">nbConnection</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="n">Counter</span><span class="p">()</span>
<span class="n">connectEtTemps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">loginAndDate</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>


<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">"^\S* "</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"username: "</span><span class="p">,</span> <span class="n">username</span><span class="p">.</span><span class="n">group</span><span class="p">())</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">username</span><span class="p">.</span><span class="n">group</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">" [A-Z][a-z][a-z] ([0-9]| )[0-9]"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">date</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"date: "</span><span class="p">,</span> <span class="n">date</span><span class="p">.</span><span class="n">group</span><span class="p">())</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date</span><span class="p">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">nbHeure</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">"\([0-9][0-9]"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbHeure</span><span class="p">:</span>
        <span class="n">nbHeure</span> <span class="o">=</span> <span class="n">nbHeure</span><span class="p">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"nbHeure: "</span><span class="p">,</span> <span class="n">nbHeure</span><span class="p">)</span>
    <span class="n">nbMinute</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">"[0-9][0-9]\)"</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbMinute</span><span class="p">:</span>
        <span class="n">nbMinute</span> <span class="o">=</span> <span class="n">nbMinute</span><span class="p">.</span><span class="n">group</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"nbMinute: "</span><span class="p">,</span> <span class="n">nbMinute</span><span class="p">)</span>

    <span class="c1"># le nombre de connexions par login (via un dictionnaire)
</span>
    <span class="n">nbConnection</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">connectEtTemps</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">connectEtTemps</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="c1"># le nombre de connexions et le temps de connexions (en minutes) par login (via un dictionnaire de listes)
</span>
    <span class="k">if</span> <span class="n">nbHeure</span> <span class="ow">and</span> <span class="n">nbMinute</span><span class="p">:</span>
        <span class="n">connectEtTemps</span><span class="p">[</span><span class="n">username</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nbHeure</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbMinute</span><span class="p">))</span>

    <span class="c1"># puis par login et par date (via un dictionnaires de dictionnaires de listes)
</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loginAndDate</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">].</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">nbHeure</span> <span class="ow">and</span> <span class="n">nbMinute</span><span class="p">:</span>
        <span class="n">loginAndDate</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="n">date</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nbHeure</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbMinute</span><span class="p">))</span>


<span class="c1"># print("nbConnections: ", nbConnection)
</span>
<span class="c1"># print("connectEtTemps: ", connectEtTemps)
</span>
<span class="c1"># print("loginAndDate: ", loginAndDate)
</span>

<span class="c1"># affichage avancé pour login and date
</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">loginAndDate</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">" s'est connecté les: "</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k2</span><span class="p">,</span><span class="n">v2</span> <span class="ow">in</span> <span class="n">v</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="s">" durant"</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v2</span><span class="p">),</span> <span class="s">"min ; "</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s">''</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>
</code></pre></div></div>

                </div>
            </div>
        </div>
    </div>
</article>

    <!-- Footer -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col m12">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="https://twitter.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a rel="me" href="https://piaille.fr/@badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://orcid.org/0000-0002-4588-2698">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-orcid fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/badetitou">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.linkedin.com/in/benoitverhaeghe">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:benoit@badetitou.fr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="text-center">Copyright &copy; badetitou 2023
                </p>
            </div>
        </div>
    </div>
</footer>

    <!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<script src="/js/my.js"></script>
<script src="/js/my-sidenav.js"></script>

<script src="/js/lightense.min.js"></script>

<script>

  // Init Lightense
  window.addEventListener("load", function() {
    Lightense("img:not(.no-lightense),.lightense", {
      background: 'rgba(0,0,0,0.05)'
    });
  }, false);

  // Example: Lazy Lightense
  document.addEventListener("DOMContentLoaded", function(e) {
    function createDom(type, cssClass) {
      var div = document.createElement(type);
      div.className = cssClass;
      return div;
    }

    var thumb = document.querySelector(".lightense-lazy");
    var original = new Image();

    // Init wrapper
    var wrap = createDom("div", "lightense-lazy-wrap");
    thumb.parentNode.insertBefore(wrap, thumb);
    wrap.appendChild(thumb);

    // Wrap thumbnail
    var thumbWrap = createDom("div", "lightense-lazy-thumb");
    thumbWrap.appendChild(thumb);
    wrap.appendChild(thumbWrap);

    // Wrap original
    var originalWrap = createDom("div", "lightense-lazy-large");
    original.src = thumb.dataset.original;
    originalWrap.appendChild(original);
    wrap.appendChild(originalWrap);

    // Load original image
    original.addEventListener(
      "load",
      function() {
        wrap.classList.add("on");
      },
      false
    );
  });
</script>


</body>

</html>
